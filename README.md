# 🕐 打卡数据处理系统

一个功能完整的打卡数据处理系统，支持Excel文件上传、错误检测、工时计算和考勤分析。

## 🏗️ 项目架构

项目采用模块化设计，便于维护和扩展：

```
timecard/
├── app.py                 # 主应用程序入口
├── config.py              # 配置文件
├── requirements.txt       # 依赖包列表
├── README.md             # 项目说明
├── utils/                # 工具模块
│   ├── __init__.py
│   └── time_utils.py     # 时间处理工具
├── processors/           # 处理器模块
│   ├── __init__.py
│   └── timecard_processor.py  # 打卡数据处理核心逻辑
├── routes/               # 路由模块
│   ├── __init__.py
│   └── api.py           # API路由
└── templates/            # 模板文件
    └── index.html       # 主页面模板
```

## 🚀 功能特性

### ✅ 核心功能
- **文件上传**：支持.xlsx和.xls格式的Excel文件
- **数据预处理**：自动提取员工打卡数据，检测时间格式错误
- **错误检测**：识别冒号距离异常和奇数时间记录
- **高亮标记**：在Excel中标记有问题的单元格
- **工时计算**：自动计算正常工时和加班时间
- **考勤分析**：检测迟到、早退、中午不打卡
- **多工作表**：生成包含4个工作表的详细报告

### 🔄 新增功能
- **修改后表格上传**：支持上传修改后的错误表格重新处理
- **灵活工作流程**：可选择直接继续或修改后重新上传
- **详细错误报告**：提供完整的处理结果统计

## 🎨 界面特色

- **现代化UI**：渐变背景、圆角设计、动画效果
- **步骤式流程**：清晰的4步操作流程
- **实时反馈**：加载动画、进度提示、错误处理
- **响应式设计**：适配不同屏幕尺寸

## 📊 输出文件

### 错误检查表
- 高亮标记有问题的单元格
- 显示错误详情和统计信息

### 最终报告（4个工作表）
1. **时间汇总**：原始打卡时间 + 计算工时 + 统计数据
2. **迟到**：标红迟到记录
3. **中午不打卡**：标红中午不打卡记录
4. **早退**：标红早退记录

### 颜色说明
- 🟡 黄色：工时统计列
- 🔴 浅红色：迟到/早退/中午不打卡
- 🔥 深红色：有问题的时间数据
- 🟢 绿色：假期列

## 🛠️ 技术栈

- **后端**：Flask (Python)
- **前端**：HTML5 + CSS3 + JavaScript
- **数据处理**：pandas, numpy
- **Excel处理**：openpyxl
- **时间处理**：datetime, holidays

## 📦 安装和运行

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 运行应用
```bash
python app.py
```

### 3. 访问系统
打开浏览器访问：http://localhost:811

## 🔧 模块说明

### config.py
- 应用程序配置管理
- 文件夹路径配置
- 文件大小限制设置

### utils/time_utils.py
- 时间字符串解析
- 时间格式验证
- 工作时间计算
- 冒号距离检测

### processors/timecard_processor.py
- 核心数据处理逻辑
- Step1：错误检测和高亮
- Step2：工时计算和考勤分析
- Excel报告生成

### routes/api.py
- RESTful API接口
- 文件上传处理
- 数据处理请求
- 文件下载服务

### templates/index.html
- 用户界面模板
- 交互式JavaScript
- 响应式CSS样式

## 🎯 使用流程

1. **上传文件**：选择Timecard Excel文件
2. **预处理**：系统自动检测错误并生成检查表
3. **选择操作**：
   - 直接继续下一步
   - 下载错误检查表，修改后重新上传
4. **生成报告**：系统计算工时并生成完整报告
5. **下载结果**：下载最终Excel报告

## 🔍 错误处理

系统能够检测和处理以下问题：
- 时间格式错误
- 冒号距离异常
- 奇数时间记录
- 无效时间数据
- 文件格式问题

## 🚀 优势特点

### 模块化设计
- **易于维护**：代码结构清晰，职责分离
- **便于扩展**：可以轻松添加新功能
- **可重用性**：工具函数可在其他项目中复用

### 用户体验
- **直观界面**：步骤式操作，清晰明了
- **实时反馈**：操作状态实时显示
- **错误处理**：友好的错误提示和处理

### 功能完整
- **全流程覆盖**：从文件上传到报告生成
- **灵活处理**：支持修改后重新处理
- **详细统计**：提供完整的处理结果

## 📝 开发说明

### 添加新功能
1. 在相应模块中添加功能代码
2. 在API路由中添加接口
3. 在前端模板中添加界面元素
4. 更新配置文件（如需要）

### 修改配置
编辑 `config.py` 文件：
- 修改文件夹路径
- 调整文件大小限制
- 更新其他配置项

### 扩展处理器
在 `processors/` 目录下添加新的处理器类，实现相应的处理逻辑。

## 🤝 贡献指南

欢迎提交Issue和Pull Request来改进这个项目！

## �� 许可证

MIT License 